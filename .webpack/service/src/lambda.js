module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=19)}([function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseDataBase=void 0;const s=o(n(11)),i=o(n(25));s.default.config();class a{convertTinyintToBoolean(e){return 1===e}convertBooleanToTinyint(e){return e?1:0}getConnection(){return null===a.connection&&(a.connection=i.default({client:"mysql",connection:{host:process.env.DB_HOST,port:Number(process.env.DB_PORT||"3306"),user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_DATABASE}})),a.connection}static destroyConnection(){return r(this,void 0,void 0,(function*(){a.connection&&(yield a.connection.destroy())}))}destroyConnection(){return r(this,void 0,void 0,(function*(){yield a.destroyConnection()}))}}t.BaseDataBase=a,a.connection=null},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Unauthorized=void 0;const r=n(7);class o extends r.BaseError{constructor(e){super(e,401)}}t.Unauthorized=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserRole=t.User=void 0;const r=n(4);var o;t.User=class{constructor(e,t,n,r,o,s,i,a){this.id=e,this.name=t,this.email=n,this.nickname=r,this.password=o,this.role=s,this.description_band=i,this.is_approved=a}getId(){return this.id}getName(){return this.name}getEmail(){return this.email}getNickname(){return this.nickname}getPassword(){return this.password}getRole(){return this.role}getDescription(){return this.description_band}getApprove(){return this.is_approved}static mapStringToUserType(e){switch(e){case"banda":return o.BANDA;case"ouvinte pagante":return o.OUVINTE_PAGANTE;case"ouvinte não pagante":return o.OUVINTE_NAO_PAGANTE;case"admin":return o.ADMIN;default:throw new r.InvalidParameterError("Invalid user role, try again")}}},function(e){e.BANDA="banda",e.OUVINTE_PAGANTE="ouvinte pagante",e.OUVINTE_NAO_PAGANTE="ouvinte não pagante",e.ADMIN="admin"}(o=t.UserRole||(t.UserRole={}))},function(e,t){e.exports=require("express")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidParameterError=void 0;const r=n(7);class o extends r.BaseError{constructor(e){super(e,422)}}t.InvalidParameterError=o},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Authenticator=void 0;const i=s(n(26));class a{generateToken(e){return i.sign({id:e.id,role:e.role},process.env.JWT_KEY,{expiresIn:a.EXPIRES_IN})}getData(e){const t=i.verify(e,process.env.JWT_KEY);return{id:t.id,role:t.role}}}t.Authenticator=a,a.EXPIRES_IN=process.env.ACESS_TOKEN_EXPIRES_IN},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdGenerator=void 0;const r=n(28);t.IdGenerator=class{generate(){return r.v4()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseError=void 0;class r extends Error{constructor(e,t){super(e),this.errorCode=t}}t.BaseError=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NotFoundError=void 0;const r=n(7);class o extends r.BaseError{constructor(e){super(e,404)}}t.NotFoundError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GenericError=void 0;const r=n(7);class o extends r.BaseError{constructor(e){super(e,400)}}t.GenericError=o},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.UserDatabase=void 0;const o=n(0),s=n(2),i=n(8),a=n(9);class u extends o.BaseDataBase{constructor(){super(...arguments),this.table="Spotenu_User"}UserFromUserModel(e){return e&&new s.User(e.id,e.name,e.email,e.nickname,e.password,e.role,e.description_band,e.is_approved)}createUser(e){return r(this,void 0,void 0,(function*(){try{yield this.getConnection().raw(`\n                INSERT INTO ${this.table} (id, name, email, nickname, password, role, description_band)\n                VALUES(\n                    "${e.getId()}",\n                    "${e.getName()}",\n                    "${e.getEmail()}",\n                    "${e.getNickname()}",\n                    "${e.getPassword()}",\n                    "${e.getRole()}",\n                    "${e.getDescription()}"\n                )\n            \n            `)}catch(e){throw new Error(e.message||e.mysqlmessage)}}))}getUserById(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){try{const n=yield t.getConnection.call(this).raw(`\n\n                SELECT *  \n                FROM ${this.table}\n                WHERE id = '${e}'\n\n            `);return this.UserFromUserModel(n[0][0])}catch(e){throw console.log(e),new i.NotFoundError("User not found")}}))}getUserByEmail(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){const n=yield t.getConnection.call(this).raw(`\n\n            SELECT *\n            FROM ${this.table}\n            WHERE email = "${e}"\n        \n            `);return this.UserFromUserModel(n[0][0])}))}getUserByNickname(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){const n=yield t.getConnection.call(this).raw(`\n\n            SELECT *\n            FROM ${this.table}\n            WHERE nickname = "${e}"\n        \n            `);return this.UserFromUserModel(n[0][0])}))}getUserByRole(e,t){const n=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){try{const t=yield n.getConnection.call(this).raw(`\n                SELECT * \n                FROM ${this.table}\n                WHERE id ='${e}'\n            `);this.UserFromUserModel(t[0][0]).getRole()===s.UserRole.BANDA&&(yield n.getConnection.call(this).raw(`\n                    UPDATE ${this.table}\n                    SET is_approved = 0\n                    WHERE id="${e}"\n                \n                `))}catch(e){throw new i.NotFoundError("User not found")}}))}approveBand(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){try{const n=yield this.getConnection().raw(`\n                SELECT * \n                FROM ${this.table}\n                WHERE id = '${e}'\n            `);if(!0===this.UserFromUserModel(n[0][0]).getApprove())throw new a.GenericError("Usuário já aprovado!");yield t.getConnection.call(this).raw(`\n                UPDATE ${this.table}\n                SET is_approved = 1\n                WHERE id = "${e}"\n           `)}catch(e){throw new i.NotFoundError("User not found")}}))}getUsersByTypeAndSortAndPage(e,t,n,o){const s=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){return(yield s.getConnection.call(this).select("name","nickname","email","is_approved").from(this.table).where({role:e}).orderBy(t.by,t.type).limit(n).offset(o)).map(e=>this.UserFromUserModel(e))}))}getUsersByRole(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){return(yield t.getConnection.call(this).raw(`\n          SELECT name, email, nickname, is_approved\n\n          FROM ${this.table}\n          WHERE role = "${e}"\n         \n        `))[0].map(e=>this.UserFromUserModel(e))}))}getAllBands(){const e=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){return(yield e.getConnection.call(this).raw(`\n          SELECT *\n          FROM ${this.table}\n          WHERE role = "banda"     \n        `))[0].map(e=>this.UserFromUserModel(e))}))}updateName(e,t){const n=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){yield n.getConnection.call(this).raw(`\n          UPDATE ${this.table}\n            SET name = "${t}"\n            WHERE id = "${e}"\n            `)}))}updateOuvinte(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){yield t.getConnection.call(this).raw(`\n            UPDATE ${this.table}\n            SET role = '${s.UserRole.OUVINTE_PAGANTE}'\n            WHERE id = "${e}"\n            `)}))}blockUser(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){yield t.getConnection.call(this).raw(`\n                UPDATE ${this.table}\n                SET is_approved = 0 \n                WHERE id = "${e}"\n            `)}))}getUserByName(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){const n=yield t.getConnection.call(this).raw(`\n\n            SELECT *\n            FROM ${this.table}\n            WHERE name = "${e}"\n        \n            `);return this.UserFromUserModel(n[0][0])}))}}t.UserDatabase=u},function(e,t){e.exports=require("dotenv")},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.HashManager=void 0;const a=s(n(27));t.HashManager=class{hash(e){return i(this,void 0,void 0,(function*(){const t=Number(process.env.BCRYPT_COST),n=yield a.genSalt(t);return yield a.hash(e,n)}))}compare(e,t){return i(this,void 0,void 0,(function*(){return a.compare(e,t)}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Genre=void 0;t.Genre=class{constructor(e,t){this.id=e,this.music_genre=t}getId(){return this.id}getMusicGenre(){return this.music_genre}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Album=void 0;t.Album=class{constructor(e,t,n,r){this.id_album=e,this.name=t,this.createdBy=n,this.id_genre=r}getId(){return this.id_album}getName(){return this.name}getCreatedBy(){return this.createdBy}getGenre(){return this.id_genre}setGenre(e){this.id_genre=e}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AlbumDatabase=void 0;const o=n(0),s=n(14);class i extends o.BaseDataBase{constructor(){super(...arguments),this.table="Spotenu_album",this.table_albuns_genre="Spotenu_albuns_genre"}AlbumFromModel(e){return e&&new s.Album(e.id_album,e.name,e.createdBy,e.id_genre)}createAlbum(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){try{yield t.getConnection.call(this).insert({id_album:e.getId(),name:e.getName(),createdBy:e.getCreatedBy()}).into("Spotenu_album"),yield t.getConnection.call(this).insert({id_album:e.getId(),id_genre:e.getGenre()}).into("Spotenu_albuns_genre")}catch(e){throw new Error(e.message||e.mysqlmessage)}}))}getAlbumById(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){try{const n=yield t.getConnection.call(this).raw(`\n\n                SELECT *\n                FROM ${this.table}\n                WHERE id = "${e}"\n            \n            `);return this.AlbumFromModel(n[0][0])}catch(e){throw new Error(e.message||e.mysqlmessage)}}))}DeleteAlbum(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){try{yield t.getConnection.call(this).del().from(this.table_albuns_genre).where({id:e}),yield t.getConnection.call(this).del().from(this.table).where({id_album:e})}catch(e){throw new Error(e.message||e.mysqlmessage)}}))}}t.AlbumDatabase=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Music=void 0;t.Music=class{constructor(e,t,n){this.id=e,this.name=t,this.id_album=n}getId(){return this.id}getName(){return this.name}getIdAlbum(){return this.id_album}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MusicDatabase=void 0;const o=n(0),s=n(16);class i extends o.BaseDataBase{constructor(){super(...arguments),this.table="Spotenu_musics"}MusicFromModel(e){return e&&new s.Music(e.id,e.name,e.id_album)}createMusic(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){try{yield t.getConnection.call(this).insert({id:e.getId(),name:e.getName(),id_album:e.getIdAlbum()}).into(this.table)}catch(e){throw new Error(e.message||e.mysqlmessage)}}))}getMusicByName(e,t){const n=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){try{return(yield n.getConnection.call(this).raw(`\n\n                SELECT *\n                FROM ${this.table}\n                WHERE name = "${e}"\n                AND\n                WHERE id_album = "${t}"\n            \n            `))[0][0].length}catch(e){throw new Error(e.message||e.mysqlmessage)}}))}getMusicId(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){try{return(yield t.getConnection.call(this).raw(`\n\n                SELECT *\n                FROM ${this.table}\n                WHERE id = "${e}"\n              \n            \n            `))[0][0]}catch(e){throw new Error(e.message||e.mysqlmessage)}}))}}t.MusicDatabase=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MusicPlaylist=t.Playlist=void 0;t.Playlist=class{constructor(e,t,n,r){this.id=e,this.name=t,this.createdBy=n,this.collaborative=r}getId(){return this.id}getName(){return this.name}getcreatedBy(){return this.createdBy}getCollaborative(){return this.collaborative}};t.MusicPlaylist=class{constructor(e,t){this.id_playlist=e,this.id_music=t}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.handler=void 0;const o=r(n(20)),s=n(21);n(44),t.handler=o.default(s.app)},function(e,t){e.exports=require("serverless-http")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.app=void 0;const o=r(n(3)),s=r(n(11)),i=n(22),a=n(29),u=n(33),c=n(36),l=r(n(39)),d=n(40);s.default.config(),t.app=o.default(),t.app.use(l.default({origin:!0})),t.app.use(o.default.json()),t.app.use("/user",i.userRouter),t.app.use("/genre",a.genreRouter),t.app.use("/album",u.albumRouter),t.app.use("/music",c.musicRouter),t.app.use("/playlist",d.playListRouter);{const e=t.app.listen(process.env.PORT||3e3,()=>{if(e){const t=e.address();console.log("Server is running in http://localhost:"+t.port)}else console.log("Failure")})}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.userRouter=void 0;const o=r(n(3)),s=n(23);t.userRouter=o.default.Router(),t.userRouter.post("/signup",(new s.UserController).signup),t.userRouter.post("/login",(new s.UserController).login),t.userRouter.put("/approve",(new s.UserController).approveBand),t.userRouter.get("/bandpage",(new s.UserController).getUsersByTypeAndSortAndPage),t.userRouter.get("/role",(new s.UserController).getUsersByRole),t.userRouter.get("/band",(new s.UserController).getAllBands),t.userRouter.get("/id",(new s.UserController).getUserById),t.userRouter.put("/update",(new s.UserController).updateName),t.userRouter.put("/premium",(new s.UserController).updateOuvinteNaoPagante),t.userRouter.put("/block",(new s.UserController).blockUser)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.UserController=void 0;const o=n(24),s=n(10),i=n(5),a=n(12),u=n(6),c=n(0),l=n(2),d=n(1);class h extends c.BaseDataBase{signup(e,t){return r(this,void 0,void 0,(function*(){try{const n={name:e.body.name,email:e.body.email,nickname:e.body.nickname,password:e.body.password,role:e.body.role,description_band:e.body.description_band};if("admin"===e.body.role){const t=e.headers.authorization;if((new i.Authenticator).getData(t).role!==l.UserRole.ADMIN)throw new d.Unauthorized("You can't do this")}const r=yield h.UserBusiness.signup(n.name,n.email,n.nickname,n.password,n.role,n.description_band);t.status(200).send(r)}catch(e){console.log("Erro do sign ip:",e),t.status(e.errorCode||400).send({message:e.message})}yield c.BaseDataBase.destroyConnection()}))}login(e,t){return r(this,void 0,void 0,(function*(){try{e.body.emailOrNickname;const n=yield h.UserBusiness.login(e.body.emailOrNickname,e.body.password);t.status(200).send(n)}catch(e){console.log(e),t.status(e.errorCode||400).send({message:e.message||e.mysqlmessage})}yield c.BaseDataBase.destroyConnection()}))}approveBand(e,t){return r(this,void 0,void 0,(function*(){try{const{id:n}=e.body,r=e.headers.authorization;if((new i.Authenticator).getData(r).role!==l.UserRole.ADMIN)throw new d.Unauthorized("You can't do this");yield h.UserBusiness.approveBand(n),t.status(200).send({message:"aprovada com sucesso"})}catch(e){t.status(e.errorCode||400).send({message:e.message})}yield c.BaseDataBase.destroyConnection()}))}getUsersByTypeAndSortAndPage(e,t){return r(this,void 0,void 0,(function*(){try{const n=e.headers.authorization;if((new i.Authenticator).getData(n).role!==l.UserRole.ADMIN)throw new d.Unauthorized("You can't do this");{const n=e.query.role,r={by:"name",type:"ASC"},o=Number(e.body.page)>=1?Number(e.body.page):1;"email"!==e.body.orderBy&&"nickname"!==e.body.orderBy||(r.by=e.body.orderBy),"DESC"===e.body.orderType&&(r.type=e.body.orderType);const s=yield h.UserBusiness.getUsersByTypeAndSortAndPage(n,r,o);t.status(200).send(s)}}catch(e){t.status(e.errorCode||400).send({message:e.message||e.mysqlmessage})}}))}getUsersByRole(e,t){return r(this,void 0,void 0,(function*(){try{const n=e.headers.authorization;if((new i.Authenticator).getData(n).role!==l.UserRole.ADMIN)throw new Error("You have no permission for see bands");const r=e.body.role,o=yield h.UserBusiness.getUsersByRole(r);return t.status(200).send(o)}catch(e){t.status(e.errorCode||400).send({message:e.message})}}))}getAllBands(e,t){return r(this,void 0,void 0,(function*(){const n=e.headers.authorization||e.headers.Authorization,r=(new i.Authenticator).getData(n);try{if(r.role!==l.UserRole.ADMIN)throw new Error("You have no permission for see bands");const e=yield h.UserBusiness.getAllBands();t.status(200).send(e)}catch(e){t.status(e.errorCode||400).send({message:e.message})}yield c.BaseDataBase.destroyConnection()}))}getUserById(e,t){return r(this,void 0,void 0,(function*(){try{const n=e.headers.authorization||e.headers.Authorization,r=((new i.Authenticator).getData(n),e.body.id),o=yield h.UserBusiness.getUserById(r);t.status(200).send(o)}catch(e){t.status(e.errorCode||400).send({message:e.message})}yield c.BaseDataBase.destroyConnection()}))}updateName(e,t){return r(this,void 0,void 0,(function*(){try{const n=e.headers.authorization||e.headers.Authorization,r=(new i.Authenticator).getData(n),o=e.body.name;yield h.UserBusiness.updateName(r.id,o),t.status(200).send({message:"Nome do usuário alterado com sucesso!"})}catch(e){t.status(e.errorCode||400).send({message:e.message})}yield c.BaseDataBase.destroyConnection()}))}updateOuvinteNaoPagante(e,t){return r(this,void 0,void 0,(function*(){try{const n=e.headers.authorization||e.headers.Authorization,r=(new i.Authenticator).getData(n),{id:o}=e.body;if(r.role!==l.UserRole.ADMIN)throw new d.Unauthorized("You can't do this");yield h.UserBusiness.updateOuvinteNaoPagante(o),t.status(200).send({message:"Ouvinte trasnformado em PREMIUM com sucesso!"})}catch(e){t.status(e.errorCode||400).send({message:e.message})}yield c.BaseDataBase.destroyConnection()}))}blockUser(e,t){return r(this,void 0,void 0,(function*(){try{const n=e.headers.authorization||e.headers.Authorization,r=(new i.Authenticator).getData(n),{id:o}=e.body;if(r.role!==l.UserRole.ADMIN)throw new d.Unauthorized("You can't do this");yield h.UserBusiness.blockUser(o),t.status(200).send({message:"Usuário bloqueado com sucesso!"})}catch(e){t.status(e.errorCode||400).send({message:e.message})}yield c.BaseDataBase.destroyConnection()}))}}t.UserController=h,h.UserBusiness=new o.UserBusiness(new s.UserDatabase,new i.Authenticator,new a.HashManager,new u.IdGenerator)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.UserBusiness=void 0;const o=n(4),s=n(2),i=n(8),a=n(9),u=n(1);t.UserBusiness=class{constructor(e,t,n,r){this.userDatabase=e,this.auth=t,this.hashGenerator=n,this.idGenerator=r}signup(e,t,n,i,a,u){return r(this,void 0,void 0,(function*(){if(!(e&&t&&n&&i&&a))throw new o.InvalidParameterError("Missing input");if(t.length<=6)throw new o.InvalidParameterError("Invalid Password");if(-1===t.indexOf("@")||-1===t.indexOf(".com"))throw new o.InvalidParameterError("Invalid E-mail");if(a===s.UserRole.ADMIN&&i.length<=10)throw new o.InvalidParameterError("Invalid password");if(a===s.UserRole.BANDA&&!u)throw new o.InvalidParameterError("Invalid description");const r=this.idGenerator.generate(),c=yield this.hashGenerator.hash(i),l=new s.User(r,e,t,n,c,s.User.mapStringToUserType(a),u);yield this.userDatabase.createUser(l),a===s.UserRole.BANDA&&(yield this.userDatabase.getUserByRole(r,a));return{Access_token:this.auth.generateToken({id:r,role:a})}}))}login(e,t){return r(this,void 0,void 0,(function*(){if(!e)throw new o.InvalidParameterError("Missing input");if(e){const n=yield this.userDatabase.getUserByEmail(e),r=yield this.userDatabase.getUserByNickname(e);if(console.log(n,r,e,"lendo as variáveis-email e senha"),n&&n.getEmail()===e){if(n.getRole()===s.UserRole.BANDA&&0==n.getApprove())throw new u.Unauthorized("Wait bitch");if(yield this.hashGenerator.compare(t,n.getPassword())){return{Access_token:yield this.auth.generateToken({id:n.getId(),role:n.getRole()}),Role:n.getRole()}}throw new o.InvalidParameterError("Inavalid input")}if(r&&r.getNickname()===e){if(r.getRole()===s.UserRole.BANDA&&!1===r.getApprove())throw new u.Unauthorized("Wait to be approved!");if(yield this.hashGenerator.compare(t,r.getPassword())){return{Access_token:yield this.auth.generateToken({id:r.getId(),role:r.getRole()}),Role:r.getRole()}}throw new o.InvalidParameterError("Somethings wrong")}throw new o.InvalidParameterError("Invalid input")}}))}approveBand(e){return r(this,void 0,void 0,(function*(){if(!(yield this.userDatabase.getUserById(e)))throw new i.NotFoundError("Band not found");yield this.userDatabase.approveBand(e);return{Banda:(yield this.userDatabase.getUserById(e)).getName()}}))}getUsersByTypeAndSortAndPage(e,t,n){return r(this,void 0,void 0,(function*(){let r=5*(n-1);return yield this.userDatabase.getUsersByTypeAndSortAndPage(e,t,5,r)}))}getUsersByRole(e){return r(this,void 0,void 0,(function*(){const t=yield this.userDatabase.getUsersByRole(e);if(!t)throw new a.GenericError("Role not found");return t}))}getAllBands(){return r(this,void 0,void 0,(function*(){return yield this.userDatabase.getAllBands()}))}getUserById(e){return r(this,void 0,void 0,(function*(){const t=yield this.userDatabase.getUserById(e);if(!t)throw new a.GenericError("id not found");return t}))}updateName(e,t){return r(this,void 0,void 0,(function*(){if(!(yield this.userDatabase.getUserById(e)))throw new a.GenericError("id not found");yield this.userDatabase.updateName(e,t)}))}updateOuvinteNaoPagante(e){return r(this,void 0,void 0,(function*(){const t=yield this.userDatabase.getUserById(e);if(!t)throw new i.NotFoundError("Usuário não encontrado.");if(t.getRole()===s.UserRole.ADMIN||t.getRole()===s.UserRole.BANDA||t.getRole()===s.UserRole.OUVINTE_PAGANTE)throw new u.Unauthorized("Apenas ouvintes não pagantes podem ser transformados em premium!");yield this.userDatabase.updateOuvinte(e)}))}blockUser(e){return r(this,void 0,void 0,(function*(){const t=yield this.userDatabase.getUserById(e);if(!t)throw new i.NotFoundError("Usuário não encontrado.");if(t.getRole()===s.UserRole.ADMIN)throw new u.Unauthorized("Você não tem permissão para bloquear um administrador!");if(0==t.getApprove())throw new a.GenericError("Este usuário já estava bloqueado.");yield this.userDatabase.blockUser(e)}))}}},function(e,t){e.exports=require("knex")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("uuid")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.genreRouter=void 0;const o=r(n(3)),s=n(30);t.genreRouter=o.default.Router(),t.genreRouter.post("/create",(new s.GenreController).createGenre),t.genreRouter.get("",(new s.GenreController).getGenre)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.GenreController=void 0;const o=n(0),s=n(31),i=n(32),a=n(5),u=n(12),c=n(6),l=n(2),d=n(1);class h extends o.BaseDataBase{createGenre(e,t){return r(this,void 0,void 0,(function*(){try{const n={music_genre:e.body.music_genre},r=e.headers.authorization;if((new a.Authenticator).getData(r).role!==l.UserRole.ADMIN)throw new d.Unauthorized("Unauthorized!!!!!");{const e=yield h.GenreBusiness.createGenre(n.music_genre);t.status(200).send({message:"Genre created",genre:e})}}catch(e){t.status(e.errorCode||400).send({message:e.message})}yield this.destroyConnection()}))}getGenre(e,t){return r(this,void 0,void 0,(function*(){try{const n=e.headers.authorization,r=(new a.Authenticator).getData(n);if(r.role!==l.UserRole.ADMIN&&r.role!==l.UserRole.BANDA)throw new Error("You have no permission for see bands");const o=yield h.GenreBusiness.getGenres();return t.status(200).send(o)}catch(e){console.log(e,"erro"),t.status(e.errorCode||400).send({message:e.message})}}))}}t.GenreController=h,h.GenreBusiness=new s.GenreBusiness(new i.GenreDatabase,new a.Authenticator,new u.HashManager,new c.IdGenerator)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.GenreBusiness=void 0;const o=n(4),s=n(13);t.GenreBusiness=class{constructor(e,t,n,r){this.genreDatabase=e,this.auth=t,this.hashGenerator=n,this.idGenerator=r}createGenre(e){return r(this,void 0,void 0,(function*(){if(!e)throw new o.InvalidParameterError("Enter with a musical genre");if(yield this.genreDatabase.getGenreByName(e))throw new o.InvalidParameterError("Try other musical genre");{const t=this.idGenerator.generate();return yield this.genreDatabase.createGenre(new s.Genre(t,e))}}))}getGenres(){return r(this,void 0,void 0,(function*(){const e=yield this.genreDatabase.getGenres();if(!e)throw new Error("None genres were found");return e}))}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.GenreDatabase=void 0;const o=n(0),s=n(13),i=n(8);class a extends o.BaseDataBase{constructor(){super(...arguments),this.table="Spotenu_Music_Genre"}Genre(e){return e&&new s.Genre(e.id,e.music_genre)}createGenre(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){try{yield t.getConnection.call(this).insert({id:e.getId(),music_genre:e.getMusicGenre()}).into("Spotenu_Music_Genre")}catch(e){throw new Error(e.message||e.mysqlmessage)}}))}getGenreByName(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){try{const n=yield t.getConnection.call(this).raw(`\n\n                SELECT *\n                FROM ${this.table}\n                WHERE music_genre = "${e}"\n            \n            `);return this.Genre(n[0][0])}catch(e){throw new Error(e.message||e.mysqlmessage)}}))}getGenreById(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){try{const n=yield t.getConnection.call(this).raw(`\n\n                SELECT *\n                FROM ${this.table}\n                WHERE id = "${e}"\n            \n            `);return this.Genre(n[0][0])}catch(e){throw new Error(e.message||e.mysqlmessage)}}))}getGenres(){const e=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){try{return(yield e.getConnection.call(this).raw(`\n                SELECT  *\n                FROM ${this.table}\n            `))[0].map(e=>this.Genre(e))}catch(e){throw new i.NotFoundError("Genre not found")}}))}}t.GenreDatabase=a},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.albumRouter=void 0;const o=r(n(3)),s=n(34);t.albumRouter=o.default.Router(),t.albumRouter.post("/create",(new s.AlbumController).createAlbum),t.albumRouter.delete("/delete",(new s.AlbumController).deleteAlbum)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AlbumController=void 0;const o=n(0),s=n(10),i=n(5),a=n(6),u=n(2),c=n(1),l=n(35),d=n(15);class h extends o.BaseDataBase{createAlbum(e,t){return r(this,void 0,void 0,(function*(){try{const n={name:e.body.name,createdBy:e.headers.authorization,id_genre:e.body.id_genre},r=(new i.Authenticator).getData(n.createdBy);if(r.role!==u.UserRole.BANDA)throw new c.Unauthorized("Unauthorized!!!!!");{const e=yield h.AlbumBusiness.createAlbum(n.name,r.id,n.id_genre);t.status(200).send({message:"Album created",album:e})}}catch(e){t.status(e.errorCode||400).send({message:e.message||e.mysqlmessage})}yield this.destroyConnection()}))}deleteAlbum(e,t){return r(this,void 0,void 0,(function*(){try{const n={id:e.params.id},r=e.headers.authorization;if((new i.Authenticator).getData(r).role!==u.UserRole.BANDA)throw new c.Unauthorized("Unauthorized!!!!!");{const e=yield h.AlbumBusiness.deleteAlbum(n.id);t.status(200).send({message:"Album deleted",album:e})}}catch(e){t.status(e.errorCode||400).send({message:e.message})}}))}}t.AlbumController=h,h.AlbumBusiness=new l.AlbumBusiness(new d.AlbumDatabase,new s.UserDatabase,new a.IdGenerator)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AlbumBusiness=void 0;const o=n(4),s=n(14),i=n(1),a=n(9);t.AlbumBusiness=class{constructor(e,t,n){this.albumDatabase=e,this.userDatabase=t,this.idGenerator=n}createAlbum(e,t,n){return r(this,void 0,void 0,(function*(){if(!e||!n)throw new o.InvalidParameterError("Missing input");const r=yield this.userDatabase.getUserById(t);if(!r.getApprove())throw new i.Unauthorized("Unauthorized!!!!!");const a=this.idGenerator.generate(),u=new s.Album(a,e,r.getId(),n);return yield this.albumDatabase.createAlbum(u)}))}deleteAlbum(e){return r(this,void 0,void 0,(function*(){if(!(yield this.albumDatabase.getAlbumById(e)))throw new a.GenericError("This album doesn't exist!!!");yield this.albumDatabase.DeleteAlbum(e)}))}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.musicRouter=void 0;const o=n(37),s=r(n(3));t.musicRouter=s.default.Router(),t.musicRouter.post("/create",(new o.MusicController).createMusic)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MusicController=void 0;const o=n(0),s=n(38),i=n(17),a=n(10),u=n(15),c=n(6),l=n(5),d=n(2),h=n(1);class y extends o.BaseDataBase{createMusic(e,t){return r(this,void 0,void 0,(function*(){try{const n={name:e.body.name,id_album:e.body.id_album},r=e.headers.authorization;if((new l.Authenticator).getData(r).role!==d.UserRole.BANDA)throw new h.Unauthorized("Unauthorized!!!!!");{const e=yield y.MusicBusiness.createMusic(n.name,n.id_album);t.status(200).send(e)}}catch(e){t.status(e.errorCode||400).send({message:e.message||e.mysqlmessage})}}))}}t.MusicController=y,y.MusicBusiness=new s.MusicBusiness(new i.MusicDatabase,new a.UserDatabase,new u.AlbumDatabase,new c.IdGenerator)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MusicBusiness=void 0;const o=n(4),s=n(9),i=n(16);t.MusicBusiness=class{constructor(e,t,n,r){this.musicDatabase=e,this.userDatabase=t,this.albumDatabase=n,this.idGenerator=r}createMusic(e,t){return r(this,void 0,void 0,(function*(){if(!e||!t)throw new o.InvalidParameterError("Missing input");yield this.albumDatabase.getAlbumById(t);const n=this.idGenerator.generate();if(yield this.musicDatabase.getMusicByName(e,t))throw new s.GenericError("This song has already been added!!!!");{const r=new i.Music(n,e,t);return yield this.musicDatabase.createMusic(r)}}))}}},function(e,t){e.exports=require("cors")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.playListRouter=void 0;const o=r(n(3)),s=n(41);t.playListRouter=o.default.Router(),t.playListRouter.post("/create",(new s.PlayListController).createPlayList),t.playListRouter.post("/add",(new s.PlayListController).addMusic)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayListController=void 0;const o=n(42),s=n(17),i=n(5),a=n(6),u=n(10),c=n(43),l=n(2),d=n(1),h=n(0);class y{createPlayList(e,t){return r(this,void 0,void 0,(function*(){try{const n=e.headers.authorization||e.headers.Authorization,r={name:e.body.name},o=(new i.Authenticator).getData(n);if(o.role!==l.UserRole.OUVINTE_PAGANTE)throw new d.Unauthorized("Unauthorized!!!!!");yield y.PlaylistBusiness.createPlayList(r.name,o.id),t.status(200).send({message:"Playlist created!"})}catch(e){t.status(e.errorCode||400).send({message:e.message})}yield h.BaseDataBase.destroyConnection()}))}addMusic(e,t){return r(this,void 0,void 0,(function*(){try{const n=e.headers.authorization||e.headers.Authorization,r=(new i.Authenticator).getData(n),{id_playlist:o,id_music:s}=e.body;if(r.role!==l.UserRole.OUVINTE_PAGANTE)throw new d.Unauthorized("Unauthorized!!!!!");yield y.PlaylistBusiness.addMusic(o,o,r.id);t.status(200).send({message:"You have successfully added the music"})}catch(e){t.status(e.errorCode||400).send({message:e.message})}}))}}t.PlayListController=y,y.PlaylistBusiness=new c.PlayListBusiness(new o.PlayListDatabase,new u.UserDatabase,new s.MusicDatabase,new a.IdGenerator,new i.Authenticator)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayListDatabase=void 0;const o=n(0),s=n(18);class i extends o.BaseDataBase{constructor(){super(...arguments),this.table_playlist="Spotenu_playlist",this.table_playlist_music="Spotenu_playlist_music",this.table_Spotenu_follower_playlist="Spotenu_follower_playlist"}PlayListFromModel(e){return e&&new s.Playlist(e.id,e.name,e.createdBy,e.collaborative)}createPlaylist(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection},convertBooleanToTinyint:{get:()=>super.convertBooleanToTinyint}});return r(this,void 0,void 0,(function*(){try{yield t.getConnection.call(this).insert({id:e.getId(),name:e.getName(),createdBy:e.getcreatedBy(),collaborative:t.convertBooleanToTinyint.call(this,!1)}).into(this.table_playlist)}catch(e){throw new Error(e.message||e.mysqlmessage)}}))}getPlaylistById(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){const n=yield t.getConnection.call(this).select("*").from(this.table_playlist).where({id:e});return this.PlayListFromModel(n[0])}))}addMusic(e,t){const n=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){yield n.getConnection.call(this).insert({id_playlist:e,id_music:t}).into(this.table_playlist_music)}))}getPlaylistsByCreatedBy(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){return(yield t.getConnection.call(this).raw(`\n            SELECT * \n            FROM ${this.table_playlist}\n            WHERE createdBy = "${e}"\n            ORDER BY name\n            GROUP BY name\n        `))[0].map(e=>this.PlayListFromModel(e))}))}getPlaylistsByCollabId(e){const t=Object.create(null,{getConnection:{get:()=>super.getConnection}});return r(this,void 0,void 0,(function*(){return(yield t.getConnection.call(this).raw(`\n            SELECT * \n            FROM ${this.table_Spotenu_follower_playlist}\n            WHERE id_collab = "${e}"\n            ORDER BY name\n            GROUP BY name\n        `))[0].map(e=>this.PlayListFromModel(e))}))}}t.PlayListDatabase=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayListBusiness=void 0;const o=n(4),s=n(1),i=n(18),a=n(8);t.PlayListBusiness=class{constructor(e,t,n,r,o){this.playlistDatabase=e,this.userDatabase=t,this.musicDatabase=n,this.idGenerator=r,this.auth=o}createPlayList(e,t){return r(this,void 0,void 0,(function*(){if(!e)throw new o.InvalidParameterError("Missing input");const n=yield this.idGenerator.generate(),r=new i.Playlist(n,e,t);yield this.playlistDatabase.createPlaylist(r)}))}addMusic(e,t,n){return r(this,void 0,void 0,(function*(){const r=yield this.playlistDatabase.getPlaylistById(e);if(!r)throw new a.NotFoundError("Try again, this playlist doesn't exist");if(!(yield this.musicDatabase.getMusicId(t)))throw new a.NotFoundError("Try again, this music doesn't exist");(yield this.playlistDatabase.getPlaylistsByCreatedBy(n))&&(yield this.playlistDatabase.addMusic(e,t));const o=yield this.playlistDatabase.getPlaylistsByCreatedBy(n);if(!1===r.getCollaborative())throw new s.Unauthorized("You can't do this!");o&&(yield this.playlistDatabase.addMusic(e,t))}))}}},function(e,t){e.exports=require("mysql")}]);